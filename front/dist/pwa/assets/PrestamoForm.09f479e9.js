import{_ as Q,Q as r,R as m,S as d,T as o,aH as F,V as t,Y as p,W as n,aC as h,aD as u,U as _,L as V,av as P,Z as x,$ as I,a0 as N,aw as E,ax as U,aI as z,aJ as L,a1 as A}from"./index.4a203205.js";import{Q as O,a as G}from"./QForm.9610866d.js";import{a as g,Q as T}from"./QMarkupTable.1f40dce1.js";import{Q as C,a as f}from"./QItem.76fae27a.js";import{Q as B,a as M}from"./QMenu.934555ea.js";import{m as S}from"./moment.19647928.js";const Y={name:"PrestamoForm",props:{prestamoData:{type:Object,required:!0},cuotasData:{type:Array,required:!0},ciData:{type:String,required:!0},nameData:{type:String,required:!0},option:{type:String,required:!0}},data(){return{loading:!1,prestamo:this.prestamoData,cuotas:this.cuotasData,ci:this.ciData,name:this.nameData,payDialog:!1,cuota:{},days:0,interDay:0}},created(){},methods:{changeDatePay(a){this.$q.dialog({title:"Cambiar fecha de pago",message:"Seleccione la nueva fecha de pago",prompt:{model:a.date,type:"date"},cancel:!0,persistent:!0}).onOk(s=>{this.$axios.put("quotaDateUpdate/"+a.id,{date:s}).then(c=>{this.cuotas=c.data.quotas})})},changeDate(a){this.option==="show"&&this.$axios.put("loanDateUpdate/"+this.prestamo.id,{date:a}).then(s=>{})},printPago(a){const s="http://api.example.comprintPago/"+a.id;window.open(s,"_blank")},payAnular(a){this.loading=!0,this.$axios.put("quotaAnular/"+a.id).then(s=>{this.$alert.success("Cuota anulada con exito"),this.cuotas=s.data.quotas,this.prestamo.status=s.data.status,this.prestamo.saldo=s.data.saldo,this.prestamo.amortization=s.data.amortization}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},payDialogShow(a){this.loading=!0,this.$axios.get("daysCuota/"+this.prestamo.id).then(s=>{this.days=s.data.days,this.interDay=s.data.interDay,this.payDialog=!0,this.cuota={...a}}).finally(()=>{this.loading=!1})},pay(){this.loading=!0,this.$axios.put("quotaPay/"+this.cuota.id,{capital:this.cuota.capital,days:this.days,interest:this.interest,custodial:this.custodial,total:this.totalPay,total_bs:this.totalBs}).then(a=>{this.$alert.success("Cuota pagada con exito"),this.cuotas=a.data.quotas,this.prestamo.status=a.data.status,this.prestamo.saldo=a.data.saldo,this.prestamo.amortization=a.data.amortization,this.payDialog=!1}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},descriptionUpdate(a){this.option==="show"&&this.$axios.put("loanDescriptionUpdate/"+this.prestamo.id,{description:a}).then(s=>{})},printCompromiso(){const a="http://api.example.comcompromiso/"+this.prestamo.id;window.open(a,"_blank")},printPlan(){const a="http://api.example.complan/"+this.prestamo.id;window.open(a,"_blank")},anularPrestamo(){this.$alert.confirm("Esta seguro de anular el prestamo?").onOk(()=>{this.loading=!0,this.$axios.put("loansAnular/"+this.prestamo.id,{status:"ANULADO"}).then(a=>{this.$alert.success("Prestamo anulado con exito"),this.$router.push("/prestamos")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})})},formatDateDmy(a){const s=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],c=a.split("-")[2],D=s[parseInt(a.split("-")[1])-1],l=a.split("-")[0];return`${c}-${D}-${l}`},loan(){if(this.cuotas.length===0)return this.$alert.error("Primero debe calcular las cuotas"),!1;if(this.ci==="")return this.$alert.error("Primero debe buscar el cliente"),!1;if(this.name==="")return this.$alert.error("Primero debe buscar el cliente"),!1;this.loading=!0,this.$axios.post("loans",{...this.prestamo,cuotas:this.cuotas,ci:this.ci,name:this.name}).then(a=>{this.$alert.success("Prestamo guardado con exito"),this.$router.push("/prestamos/"+a.data.id)}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},calculate(){let a=this.prestamo.amount;const s=this.prestamo.payments,c=this.prestamo.interest_rate,D=this.prestamo.custodial_fee,l=this.prestamo.currency;this.cuotas=[];let i=0,e=0,b=0,y=0,w=0;const v=a/s;let k=S(this.prestamo.date).format("YYYY-MM-DD");for(let q=0;q<s;q++)b=a*c/100,y=a*D/100,e=b+y+v,l==="DOLARES"?i=e*this.prestamo.dolar:i=e,w=Math.round((a-v)*100)/100,k=S(k).add(1,"months").format("YYYY-MM-DD"),this.cuotas.push({amount:parseFloat(a).toFixed(2),interest:b.toFixed(2),custodial_fee:y.toFixed(2),capital:v.toFixed(2),saldo:w.toFixed(2),total_bs:i.toFixed(2),date:k}),a-=v},clientSearch(){this.loading=!0,this.$axios.get("clients/search",{params:{ci:this.ci}}).then(a=>{a.data!==""&&(this.name=a.data[0].name)}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},submit(){}},computed:{interest(){return parseFloat(this.interDay*this.days*this.prestamo.saldo/100).toFixed(2)},custodial(){return parseFloat(this.prestamo.saldo*this.prestamo.custodial_fee/100).toFixed(2)},totalPay(){return(parseFloat(this.cuota.capital)+this.interDay*this.days*this.prestamo.saldo/100+this.prestamo.saldo*this.prestamo.custodial_fee/100).toFixed(2)},totalBs(){return this.prestamo.currency==="DOLARES"?((parseFloat(this.cuota.capital)+this.interDay*this.days*this.prestamo.saldo/100+this.prestamo.saldo*this.prestamo.custodial_fee/100)*this.prestamo.dolar).toFixed(2):(parseFloat(this.cuota.capital)+this.interDay*this.days*this.prestamo.saldo/100+this.prestamo.saldo*this.prestamo.custodial_fee/100).toFixed(2)}}},R={class:"row"},j={class:"col-6 col-md-1 q-pa-xs"},H={class:"text-h6 text-red flex flex-center",style:{"line-height":"1"}},J=t("b",null,"Id:",-1),W={class:"col-6 col-md-3 q-pa-xs"},Z={class:"col-6 col-md-2 q-pa-xs"},K={class:"col-6 col-md-6 q-pa-xs"},X={class:"col-6 col-md-3 q-pa-xs"},$={class:"col-6 col-md-2 q-pa-xs"},ee={class:"col-6 col-md-2 q-pa-xs text-center"},te={class:"col-6 col-md-2 q-pa-xs"},se={class:"col-6 col-md-2 q-pa-xs"},le={class:"col-12 col-md-12 q-pa-xs"},ae={class:"col-6 col-md-2 q-pa-xs"},oe={class:"col-6 col-md-2 q-pa-xs"},ie={class:"col-6 col-md-2 q-pa-xs"},re={class:"col-6 col-md-2 q-pa-xs"},ne={class:"col-6 col-md-2 flex flex-center"},de={class:"col-6 col-md-2 flex flex-center"},ue={class:"col-12"},ce=t("thead",{class:"bg-primary text-white"},[t("tr",null,[t("th",null,[t("div",{class:"text-bold"},"#")]),t("th",null,[t("div",{class:"text-bold"},"Opcion")]),t("th",null,[t("div",{class:"text-bold"},"Estado")]),t("th",null,[t("div",{class:"text-bold"},"Saldo Inicial")]),t("th",null,[t("div",{class:"text-bold"},"Interes")]),t("th",null,[t("div",{class:"text-bold"},"Custodia")]),t("th",null,[t("div",{class:"text-bold"},"Capital")]),t("th",null,[t("div",{class:"text-bold"},"Total")]),t("th",null,[t("div",{class:"text-bold"},"Saldo Final")]),t("th",null,[t("div",{class:"text-bold"},"Total A Pagar")]),t("th",null,[t("div",{class:"text-bold"},"Fecha")])])],-1),me={class:"text-subtitle2 text-right"},pe={class:"text-subtitle2 text-right"},he={class:"text-subtitle2 text-right"},xe={class:"text-subtitle2 text-right"},_e={key:0,class:"text-red"},ye={class:"text-subtitle2 text-right"},be={key:0,class:"text-red"},ge={class:"text-subtitle2 text-right"},fe={key:0,class:"text-red"},De={class:"text-subtitle2 text-right text-bold"},ve={key:0,class:"text-red"},ke={class:"text-subtitle2 text-right"},Ve={key:0,class:"text-red"},Pe={class:"text-subtitle2 text-right"},Ae={class:"text-subtitle2 text-right"},Ce={key:0,class:"text-red"},we=["onClick"],qe=t("br",null,null,-1),Fe={key:0,class:"text-red"},Ee={class:"row"},Ue=t("div",{class:"col-12 col-md-12 q-pa-xs"},[t("div",{class:"text-h6 text-red flex flex-center",style:{"line-height":"1"}},[t("b",null,"Pagar cuota")])],-1),Oe={class:"col-12 col-md-2 q-pa-xs"},Se={class:"col-12 col-md-2 q-pa-xs"},Qe={class:"col-12 col-md-2 q-pa-xs"},Ie=t("div",{class:"text-red flex flex-center",style:{"line-height":"1"}},[t("b",null,"Interes")],-1),Ne={class:"col-12 col-md-2 q-pa-xs"},ze=t("div",{class:"text-red flex flex-center",style:{"line-height":"1"}},[t("b",null,"Custodia")],-1),Le={class:"col-12 col-md-2 q-pa-xs"},Ge=t("div",{class:"text-red flex flex-center",style:{"line-height":"1"}},[t("b",null,"Total")],-1),Te={class:"text-bold"},Be={class:"col-12 col-md-2 q-pa-xs"},Me=t("div",{class:"text-red flex flex-center",style:{"line-height":"1"}},[t("b",null,"Total Bs")],-1);function Ye(a,s,c,D,l,i){return r(),m(U,null,{default:d(()=>[o(E,null,{default:d(()=>[o(O,{onSubmit:F(i.submit,["prevent"])},{default:d(()=>[t("div",R,[t("div",j,[t("div",H,[J,p(" "+n(l.prestamo.id),1)])]),t("div",W,[o(h,{modelValue:l.prestamo.date,"onUpdate:modelValue":[s[0]||(s[0]=e=>l.prestamo.date=e),i.changeDate],outlined:"",dense:"",label:"Fecha",type:"date"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Z,[o(h,{modelValue:l.ci,"onUpdate:modelValue":[s[1]||(s[1]=e=>l.ci=e),i.clientSearch],outlined:"",dense:"",label:"C.I.",debounce:"500",rules:[e=>!!e||"La cedula de identidad es requerida"],readonly:c.option==="show"},null,8,["modelValue","onUpdate:modelValue","rules","readonly"])]),t("div",K,[o(h,{modelValue:l.name,"onUpdate:modelValue":s[2]||(s[2]=e=>l.name=e),outlined:"",dense:"",label:"Nombre",rules:[e=>!!e||"El nombre es requerido"],readonly:c.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",X,[o(G,{modelValue:l.prestamo.currency,"onUpdate:modelValue":s[3]||(s[3]=e=>l.prestamo.currency=e),outlined:"",dense:"",label:"Moneda",options:["DOLARES","BOLIVIANOS"],readonly:c.option==="show"},null,8,["modelValue","readonly"])]),t("div",$,[o(h,{modelValue:l.prestamo.dolar,"onUpdate:modelValue":s[4]||(s[4]=e=>l.prestamo.dolar=e),outlined:"",dense:"",label:"Dolar",type:"number",step:"0.01",rules:[e=>!!e||"El dolar es requerido",e=>e>0||"El dolar debe ser mayor a 0"],readonly:c.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",ee,[l.prestamo.status==="PENDIENTE"?(r(),m(g,{key:0,color:"orange","text-color":"white",label:"Pendiente"})):u("",!0),l.prestamo.status==="PAGADO"?(r(),m(g,{key:1,color:"positive","text-color":"white",label:"Pagado"})):u("",!0),l.prestamo.status==="ANULADO"?(r(),m(g,{key:2,color:"negative","text-color":"white",label:"Anulado"})):u("",!0)]),t("div",te,[o(h,{modelValue:l.prestamo.interest_rate,"onUpdate:modelValue":s[5]||(s[5]=e=>l.prestamo.interest_rate=e),outlined:"",dense:"",label:"Interes %",type:"number",rules:[e=>!!e||"El interes es requerido",e=>e>0||"El interes debe ser mayor a 0"],readonly:c.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",se,[o(h,{modelValue:l.prestamo.custodial_fee,"onUpdate:modelValue":s[6]||(s[6]=e=>l.prestamo.custodial_fee=e),outlined:"",dense:"",label:"Custodia %",type:"number",rules:[e=>!!e||"La custodia es requerida",e=>e>0||"La custodia debe ser mayor a 0"],readonly:c.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",le,[o(h,{type:"textarea",modelValue:l.prestamo.description,"onUpdate:modelValue":[s[7]||(s[7]=e=>l.prestamo.description=e),i.descriptionUpdate],outlined:"",dense:"",label:"Descripcion",debounce:1e3},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ae,[o(h,{modelValue:l.prestamo.amount,"onUpdate:modelValue":s[8]||(s[8]=e=>l.prestamo.amount=e),outlined:"",dense:"",label:"Monto",type:"number",rules:[e=>!!e||"El monto es requerido",e=>e>0||"El monto debe ser mayor a 0"],readonly:c.option==="show","bg-color":"orange","label-color":"white"},null,8,["modelValue","rules","readonly"])]),t("div",oe,[o(h,{modelValue:l.prestamo.saldo,"onUpdate:modelValue":s[9]||(s[9]=e=>l.prestamo.saldo=e),outlined:"",dense:"",label:"Saldo",type:"number",readonly:!0,"bg-color":"red-5","label-color":"white"},null,8,["modelValue"])]),t("div",ie,[o(h,{modelValue:l.prestamo.amortization,"onUpdate:modelValue":s[10]||(s[10]=e=>l.prestamo.amortization=e),outlined:"",dense:"",label:"Amortizacion",type:"number",readonly:!0,"bg-color":"green-5","label-color":"white"},null,8,["modelValue"])]),t("div",re,[o(h,{modelValue:l.prestamo.payments,"onUpdate:modelValue":s[11]||(s[11]=e=>l.prestamo.payments=e),outlined:"",dense:"",label:"Pagos",type:"number",rules:[e=>!!e||"El numero de pagos es requerido",e=>e>0||"El numero de pagos debe ser mayor a 0"],readonly:c.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",ne,[c.option==="create"?(r(),m(_,{key:0,color:"primary",label:"Calcular",type:"submit",loading:l.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_calculate",onClick:i.calculate},null,8,["loading","onClick"])):u("",!0)]),t("div",de,[c.option==="create"?(r(),m(_,{key:0,color:"green",label:"Guardar",type:"submit",loading:l.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_save",onClick:i.loan},null,8,["loading","onClick"])):u("",!0),c.option==="show"?(r(),m(_,{key:1,color:"indigo",label:"Opciones",loading:l.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_settings"},{default:d(()=>[o(B,null,{default:d(()=>[o(M,null,{default:d(()=>[V((r(),m(C,{clickable:"",onClick:i.printCompromiso},{default:d(()=>[o(f,{avatar:""},{default:d(()=>[o(P,{name:"o_print"})]),_:1}),o(f,null,{default:d(()=>[p("Compromiso de pago")]),_:1})]),_:1},8,["onClick"])),[[A]]),V((r(),m(C,{clickable:"",onClick:i.printPlan},{default:d(()=>[o(f,{avatar:""},{default:d(()=>[o(P,{name:"o_print"})]),_:1}),o(f,null,{default:d(()=>[p("Plan de pago")]),_:1})]),_:1},8,["onClick"])),[[A]]),l.prestamo.status==="PENDIENTE"?V((r(),m(C,{key:0,clickable:"",onClick:i.anularPrestamo},{default:d(()=>[o(f,{avatar:""},{default:d(()=>[o(P,{name:"o_block"})]),_:1}),o(f,null,{default:d(()=>[p("Anular prestamo")]),_:1})]),_:1},8,["onClick"])),[[A]]):u("",!0)]),_:1})]),_:1})]),_:1},8,["loading"])):u("",!0)]),t("div",ue,[o(T,{dense:"","wrap-cells":"",flat:"",bordered:"",separator:"cell",class:"bg-grey-3"},{default:d(()=>[ce,t("tbody",null,[(r(!0),x(N,null,I(l.cuotas,(e,b)=>(r(),x("tr",{key:b},[t("td",me,n(b+1),1),t("td",pe,[c.option==="show"&&e.status==="PAGADO"?(r(),m(_,{key:0,color:"red",label:"Anular",dense:"","no-caps":"",size:"12px",class:"text-bold",icon:"o_block",onClick:y=>i.payAnular(e),loading:l.loading},null,8,["onClick","loading"])):u("",!0),c.option==="show"&&e.isLast&&l.prestamo.status==="PENDIENTE"?(r(),m(_,{key:1,color:"positive",label:"Pagar",dense:"","no-caps":"",size:"12px",class:"text-bold",icon:"o_payment",onClick:y=>i.payDialogShow(e),loading:l.loading},null,8,["onClick","loading"])):u("",!0)]),t("td",he,[e.status==="PENDIENTE"?(r(),m(g,{key:0,dense:"",color:"orange","text-color":"white",label:"Pendiente"})):u("",!0),e.status==="PAGADO"?(r(),m(_,{key:1,dense:"",flat:"",color:"indigo",round:"",size:"12px",class:"text-bold",icon:"o_print",onClick:y=>i.printPago(e)},null,8,["onClick"])):u("",!0),e.status==="PAGADO"?(r(),m(g,{key:2,dense:"",color:"positive","text-color":"white",label:"Pagado"})):u("",!0),e.status==="ANULADO"?(r(),m(g,{key:3,dense:"",color:"negative","text-color":"white",label:"Anulado"})):u("",!0)]),t("td",xe,[p(n(e.amount)+" ",1),e.status=="PAGADO"?(r(),x("b",_e,n(e.days)+"d",1)):u("",!0)]),t("td",ye,[p(n(e.interest)+" ",1),e.status=="PAGADO"?(r(),x("b",be,n(e.interest_paid),1)):u("",!0)]),t("td",ge,[p(n(e.custodial_fee)+" ",1),e.status=="PAGADO"?(r(),x("b",fe,n(e.custodial_fee_paid),1)):u("",!0)]),t("td",De,[p(n(e.capital)+" ",1),e.status=="PAGADO"?(r(),x("b",ve,n(e.capital_paid),1)):u("",!0)]),t("td",ke,[p(n((parseFloat(e.interest)+parseFloat(e.custodial_fee)+parseFloat(e.capital)).toFixed(2))+" ",1),e.status=="PAGADO"?(r(),x("b",Ve,n(e.total_bs_paid),1)):u("",!0)]),t("td",Pe,n(e.saldo),1),t("td",Ae,[p(n(e.total_bs)+" ",1),e.status=="PAGADO"?(r(),x("b",Ce,n(e.total_bs_paid),1)):u("",!0)]),t("td",{class:"text-subtitle2",onClick:y=>i.changeDatePay(e)},[p(n(i.formatDateDmy(e.date))+" ",1),qe,e.status=="PAGADO"?(r(),x("b",Fe,n(i.formatDateDmy(e.date_paid)),1)):u("",!0)],8,we)]))),128))])]),_:1}),t("pre",null,n(l.cuotas),1)])])]),_:1},8,["onSubmit"])]),_:1}),o(L,{modelValue:l.payDialog,"onUpdate:modelValue":s[15]||(s[15]=e=>l.payDialog=e),persistent:""},{default:d(()=>[o(U,{style:{width:"750px","max-width":"100vw"}},{default:d(()=>[o(E,null,{default:d(()=>[o(O,{onSubmit:F(i.submit,["prevent"])},{default:d(()=>[t("div",Ee,[Ue,t("div",Oe,[o(h,{modelValue:l.cuota.capital,"onUpdate:modelValue":s[12]||(s[12]=e=>l.cuota.capital=e),outlined:"",dense:"",label:"Capital",type:"number"},null,8,["modelValue"])]),t("div",Se,[o(h,{modelValue:l.days,"onUpdate:modelValue":s[13]||(s[13]=e=>l.days=e),outlined:"",dense:"",label:"Dias de atraso",type:"number"},null,8,["modelValue"])]),t("div",Qe,[Ie,p(" "+n(i.interest),1)]),t("div",Ne,[ze,p(" "+n(i.custodial),1)]),t("div",Le,[Ge,t("div",Te,n(i.totalPay),1)]),t("div",Be,[Me,p(" "+n(i.totalBs),1)])])]),_:1},8,["onSubmit"])]),_:1}),o(z,{align:"right"},{default:d(()=>[o(_,{color:"primary",label:"Pagar",type:"submit",loading:l.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_payment",onClick:i.pay},null,8,["loading","onClick"]),o(_,{color:"negative",label:"Cancelar",type:"submit",loading:l.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_block",onClick:s[14]||(s[14]=e=>l.payDialog=!1)},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ke=Q(Y,[["render",Ye]]);export{Ke as P};
